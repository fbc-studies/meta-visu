!function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){"use strict";a.r(e);var n=class{constructor(t,e,a){this.config={width:a.width?a.width:400,height:a.height?a.height:200,posX:a.posX?a.posX:0,posY:a.posY?a.posY:0,childrenNames:a.childrenNames?a.childrenNames:["registerAdmins","registers","categories","samplings"],nodeSize:a.nodeSize?a.nodeSize:10,animationDuration:a.animationDuration?a.animationDuration:750};const n=this.config.height,i=this.config.width,s=d3.tree().size([n,i]).separation(()=>1),r=d3.hierarchy(t,t=>this.findChildArr(t));this.treeData=s(r),this.svg=e.append("g").attr("class","tree").attr("width",this.config.width).attr("height",this.config.height).attr("transform",`translate(${this.config.posX}, ${this.config.posY})`).append("g"),this.sourceCoord={x:n/2,y:0},this.idCounter=0}static diagonal(t,e){return`M ${t.y} ${t.x}\n                  C ${(t.y+e.y)/2} ${t.x},\n                    ${(t.y+e.y)/2} ${e.x},\n                    ${e.y} ${e.x}`}static calculateLabelPlacement(t){try{Math.ceil(t.x)>Math.ceil(t.parent.x)?t.labelPosition="under":Math.ceil(t.x)<Math.ceil(t.parent.x)?t.labelPosition="top":t.labelPosition=t.parent.labelPosition?t.parent.labelPosition:"top"}finally{switch(t.labelPosition){case"top":return"-1em";case"under":return"1.5em";default:return"0em"}}}findChildArr(t){const e=this.config.childrenNames.filter(e=>void 0!==t[e])[0];return void 0!==e?t[e]:null}drawNodeCircles(t){t.append("circle").attr("class","tree__node-marker").attr("r",this.config.nodeSize)}moveNodesInPlace(t){t.attr("transform",t=>`translate(${t.y}, ${t.x})`)}addNodeLabels(t){t.filter(t=>t.parent).append("text").attr("class","tree__node-label").attr("dy",t=>this.constructor.calculateLabelPlacement(t)).attr("x",-13).attr("text-anchor","middle").text(t=>t.data.name),this.addRootLabel(t.filter(t=>!t.parent))}addRootLabel(t){const e=t.append("foreignObject").attr("class","tree__html-object"),a=e.append("xhtml:p").attr("class","tree__html-label").html(t=>t.data.name).node().getBoundingClientRect();e.attr("transform",`translate(${-1*a.width}, ${a.height/-2})`)}updateNodes(){const t=this.treeData.descendants(),e=this.svg.selectAll(".node").data(t,t=>{const e=t.id?t.id:this.idCounter;return t.id=e,this.idCounter+=1,e}),a=e.enter().append("g").attr("class","tree__node").attr("transform",()=>`translate(${this.sourceCoord.y}, ${this.sourceCoord.x})`);this.moveNodesInPlace(a),this.addNodeLabels(a),e.exit().attr("transform",`translate(${this.sourceCoord.y}, ${this.sourceCoord.x})`).remove()}updateLinks(){const t=this.treeData.descendants().slice(1),e=this.svg.selectAll("path.link").data(t,t=>{const e=t.id?t.id:this.idCounter;return t.id=e,this.idCounter+=1,e});e.enter().insert("path","g").attr("class","tree__link").attr("d",()=>{const t={x:this.sourceCoord.x,y:this.sourceCoord.y};return this.constructor.diagonal(t,t)}).attr("d",t=>this.constructor.diagonal(t,t.parent)),e.exit().transition().duration(750).attr("d",()=>{const t={y:this.sourceCoord.y,x:this.sourceCoord.x};return this.constructor.diagonal(t,t)}).remove()}};var i=class{constructor(t,e,a){this.config={width:a.width?a.width:400,height:a.height?a.height:200,posX:a.posX?a.posX:0,posY:a.posY?a.posY:0,scaleStartDate:a.scaleStartDate?a.scaleStartDate:new Date("1970-01-01"),scaleEndDate:a.scaleEndDate?a.scaleEndDate:new Date,xAxisOrientation:a.xAxisOrientation?a.xAxisOrientation:"bottom",showXAxis:null==a.showXAxis||a.showXAxis,showLegend:null==a.showLegend||a.showLegend},this.data=t,this.xAxisPadding=30,this.svg=e.append("g").attr("class","timeline-chart").attr("width",this.config.width).attr("height",this.config.height+this.xAxisPadding).attr("transform",`translate(${this.config.posX}, ${this.config.posY})`),this.x=d3.scaleTime().domain([this.config.scaleStartDate,this.config.scaleEndDate]).range([0,this.config.width-25]),this.y=d3.scaleBand().domain(t.map(t=>t.type)).range([this.xAxisPadding,this.config.height]).paddingInner(.25).round(!0)}static findEarliestStartDate(t){return d3.min(t,t=>new Date(t.startDate))}static findLatestEndDate(t){return d3.max(t,t=>new Date(t.endDate))}static createYearLabel(t){const e=new Date(t.startDate),a=new Date(t.endDate),n=e.getMonth(),i=a.getMonth(),s=e.getFullYear(),r=a.getFullYear(),o=0===n?s:`${n+1}/${s}`,l=11===i?r:`${a.getMonth()+1}/${r}`;if(s===r){if(n===i)return o;if(0===n&&11===i)return s}return`${o}â€”${l}`}drawXAxis(){let t;(t="top"===this.config.xAxisOrientation?d3.axisTop(this.x):d3.axisBottom(this.x)).ticks(d3.timeYear.every(10)),this.svg.append("g").attr("class","timeline__axis").call(t).attr("transform",()=>"top"===this.config.xAxisOrientation?"translate(0, -2.5)":`translate(0, ${this.config.height-this.xAxisPadding+2.5})`)}drawLegend(){const t=this.svg.append("g").attr("class","legend");t.attr("transform",`translate(${this.config.width-15}, 0)`);const e=t.append("g").attr("class","legend__category");e.append("rect").attr("class","legend__color-1").attr("width",this.y.bandwidth()/2).attr("height",this.y.bandwidth()/2),e.append("text").attr("class","legend__label").text("1987").attr("transform",`translate(${this.y.bandwidth()/2+5}, ${this.y.bandwidth()/2-5})`);const a=t.append("g").attr("class","legend__category");a.append("rect").attr("class","legend__color-2").attr("width",this.y.bandwidth()/2).attr("height",this.y.bandwidth()/2).attr("transform",`translate(0, ${this.y.bandwidth()/2})`),a.append("text").attr("class","legend__label").text("1997").attr("transform",`translate(${this.y.bandwidth()/2+5}, ${this.y.bandwidth()-5})`)}calculateSectionWidth(t){return this.x(new Date(t.endDate))-this.x(new Date(t.startDate))}calculateSectionXPos(t){return this.x(new Date(t.startDate))}positionYearLabel(t){return`translate(${(this.x(new Date(t.startDate))+this.x(new Date(t.endDate)))/2-2}, ${this.y.bandwidth()/2-4})`}moveTo(t,e){this.svg.attr("transform",`translate(${t}, ${e})`)}update(){this.config.showXAxis&&this.drawXAxis(),this.config.showLegend&&this.drawLegend();const t=this.svg.selectAll(".timeline").data(this.data).enter().append("g").attr("class","timeline");t.attr("transform",t=>`translate(0, ${this.y(t.type)-this.xAxisPadding})`),t.filter(t=>"parents"===t.type).append("line").attr("class","timeline__separator").attr("x1",this.x(this.config.scaleStartDate)-60).attr("y1",this.y.bandwidth()+5).attr("x2",this.x(this.config.scaleEndDate)).attr("y2",this.y.bandwidth()+5),t.append("text").attr("class","timeline__title").text(t=>t.type).attr("dy","1.5em").attr("dx","-5em");const e=t.selectAll("timeline__section").data(t=>t.data).enter().append("g").attr("class","timeline__section");e.filter(t=>new Date(t.startDate).getFullYear()!==new Date(t.endDate).getFullYear()).append("rect").attr("class","timeline__rect").attr("x",t=>this.calculateSectionXPos(t)).attr("height",this.y.bandwidth()/2).attr("width",t=>this.calculateSectionWidth(t)),e.filter(t=>new Date(t.startDate).getFullYear()===new Date(t.endDate).getFullYear()).append("circle").attr("r",this.y.bandwidth()/4).attr("class","timeline__rect").attr("cx",t=>this.calculateSectionXPos(t)).attr("cy",7.5),e.append("text").attr("class","timeline__year-label").text(t=>this.constructor.createYearLabel(t)).attr("text-anchor","middle").attr("transform",t=>this.positionYearLabel(t)),e.filter(t=>"1997"===t.cohort).attr("transform",`translate(0, ${this.y.bandwidth()/2})`).select(".timeline__rect").attr("class","timeline__rect timeline__rect--97")}};function s(t,e){return t.name<e.name?-1:t.name>e.name?1:0}function r(t){return t.registers.sort((t,e)=>s(t,e)),t.registers.forEach(t=>t.categories.sort((t,e)=>s(t,e))),t}async function o(t){return fetch(t).then(t=>t.json()).then(t=>t)}async function l(t,e=[]){let a=await o(`data/${t}`);const s=a.registers.filter(t=>!e.includes(t.name));a.registers=s;const l=100*function(t){let e=0;return t.registers.forEach(t=>t.categories.forEach(t=>e+=1)),e}(a=r(a)),c={width:450,height:l,posX:125,posY:50,childrenNames:["registers","categories"],animationDuration:750,nodeSize:7.5},d=d3.select(`main.chart-area>div[data-filename="${t}"]`).append("svg").attr("data-filename",t).attr("height",l+100).attr("width",1050).attr("class","timeline-tree js-timeline-tree"),h=new n(a,d,c);h.updateNodes(),h.updateLinks();const u={width:250,height:100,showXAxis:!1,showLegend:!1,scaleStartDate:new Date("1950-01-01")};h.treeData.children.forEach((t,e)=>{t.children.forEach((a,n)=>{let s=u;e===h.treeData.children.length-1&&n===t.children.length-1&&(s={...u,showXAxis:!0,showLegend:!0});const r=function(t,e,a){let n=t;const s=n.filter(t=>t.parents),r=n.filter(t=>!t.parents);return new i(n=[{type:"parents",data:s},{type:"subjects",data:r}],e,a)}(a.data.samplings,d,s);r.moveTo(a.y+300,a.x+12.5),r.update()})})}function c(t){const e=document.querySelector(`.js-timeline-tree[data-filename="${t}"]`);e&&e.remove()}async function d(t,e){let a=await o(`data/${e}`);a=r(a);const n=document.createElement("ul");n.classList.add("register-selector"),a.registers.forEach(t=>{const a=`${e}/${t.name}`,i=document.createElement("li");i.classList.add("register__item"),i.innerHTML=`<input class="js-register-select" type="checkbox" id="${a}" \n    data-identifier="${a}" checked/>\n    <label for="${a}">${t.name}</label>`,n.appendChild(i)}),t.appendChild(n),function(t){t.querySelectorAll(".js-register-select").forEach(e=>{e.addEventListener("change",()=>{const a=e.dataset.identifier.split("/")[0],n=[...t.querySelectorAll(".js-register-select")].filter(t=>!t.checked).map(t=>t.dataset.identifier.split("/")[1]);c(a),l(a,n)})})}(n)}function h(){document.querySelectorAll(".js-btn").forEach(t=>{t.addEventListener("click",()=>{const{filename:e}=t.dataset;[...t.classList].includes("btn--selected")?(c(e),function(t){t.querySelector(".register-selector").classList.add("vanish")}(t.parentElement),t.classList.remove("btn--selected")):(t.classList.add("btn--selected"),l(e),async function(t,e){const a=t.querySelector(".register-selector");null===a?d(t,e):a.classList.remove("vanish")}(t.parentElement,e))})})}!async function(){const t=await o("data/filenames.json");t.sort(),function(t){t.forEach(t=>{const e=document.createElement("div");e.classList.add("timeline-tree-wrapper"),e.dataset.filename=t,document.querySelector("main.chart-area").appendChild(e)})}(t),function(t){t.map(t=>t.split(".")[0]).sort().forEach(t=>{const e=document.createElement("li");e.classList.add("nav__item"),e.innerHTML=`<button class="btn js-btn" data-filename="${t}.json">${t}</button>`,document.querySelector(".js-nav-list").appendChild(e)})}(t),h();const e=document.querySelector(".js-toggle-menu");e.addEventListener("click",()=>{document.querySelector(".js-nav-card").classList.toggle("nav--closed"),e.classList.toggle("nav__toggle-btn--rotate")}),document.querySelector('.js-btn[data-filename="National Institute for Health and Welfare.json"]').click()}()}]);